<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff - Complaint Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #ecf0f1; }
        .dashboard-container { display: flex; flex-direction: column; min-height: 100vh; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 10px rgba(0,0,0,0.1);} 
        .header h1 { font-size: 24px; margin:0; }
        .header-actions { display:flex; gap:12px; align-items:center; }
        .header a { color:white; text-decoration:none; padding:8px 14px; border-radius:4px; background: rgba(255,255,255,0.12); }
        .main-content { padding: 24px; flex:1; }
        .detail-card { background:white; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.08); padding:20px; margin-bottom:20px; }
        .detail-row { display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-bottom:12px; }
        .detail-label { color:#666; font-size:12px; font-weight:600; text-transform:uppercase; margin-bottom:6px; }
        .detail-value { color:#333; font-size:15px; }
        .status-badge{ display:inline-block; padding:8px 14px; border-radius:18px; font-weight:700; }
        .status-pending{ background:#fff3cd; color:#856404; }
        .status-progress{ background:#cfe2ff; color:#084298; }
        .status-completed{ background:#d1e7dd; color:#0f5132; }
        .image-section{ display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-top:12px; }
        .image-container{ border:2px solid #f0f0f0; border-radius:8px; overflow:hidden; background:#fafafa; min-height:260px; display:flex; align-items:center; justify-content:center; }
        .image-container img{ width:100%; height:100%; object-fit:contain; }
        .description-box{ background:#f8f9ff; padding:12px; border-radius:8px; border-left:4px solid #667eea; }
        .action-panel{ background:white; border-radius:12px; padding:18px; box-shadow:0 4px 15px rgba(0,0,0,0.06); margin-bottom:20px; }
        .btn-assign{ background:#667eea; color:white; border:none; padding:10px 18px; border-radius:8px; }
        .btn-save{ background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border:none; padding:10px 18px; border-radius:8px; }
        footer{ background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; text-align:center; padding:14px; position:fixed; bottom:0; width:100%; }
        @media(max-width:768px){ .detail-row{ grid-template-columns:1fr; } .image-section{ grid-template-columns:1fr; } }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <div style="display:flex; align-items:center; gap:12px;">
                <h1>üëÆ‚Äç Staff - Complaint Details</h1>
            </div>
            <div class="header-actions">
                <a href="{{ url_for('staff_dashboard') }}"><i class="fas fa-home"></i> Dashboard</a>
                <a href="{{ url_for('update_status') }}"><i class="fas fa-list"></i> Complaints</a>
                <a href="{{ url_for('staff_logout') }}">Logout</a>
            </div>
        </div>

        <div class="main-content">
            <div class="detail-card">
                <div class="detail-row">
                    <div>
                        <div class="detail-label">Report ID</div>
                        <div class="detail-value"><strong>#{{ complaint[0] }}</strong></div>
                    </div>
                    <div>
                        <div class="detail-label">Status</div>
                        <div class="detail-value">
                            {% if complaint[22] == 'Pending' %}
                                <span class="status-badge status-pending">‚è≥ Pending</span>
                            {% elif complaint[22] == 'Progress' %}
                                <span class="status-badge status-progress">‚è≥ In Progress</span>
                            {% else %}
                                <span class="status-badge status-completed">‚úì {{ complaint[22] }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="detail-row">
                    <div>
                        <div class="detail-label">Full Name</div>
                        <div class="detail-value">{{ complaint[1] }}</div>
                    </div>
                    <div>
                        <div class="detail-label">Email</div>
                        <div class="detail-value">{{ complaint[2] }}</div>
                    </div>
                </div>

                <div class="detail-row">
                    <div>
                        <div class="detail-label">Phone Number</div>
                        <div class="detail-value">{{ complaint[3] }}</div>
                    </div>
                    <div>
                        <div class="detail-label">Crime Date</div>
                        <div class="detail-value">{{ complaint[6] }}</div>
                    </div>
                </div>

                <div class="detail-row">
                    <div>
                        <div class="detail-label">Location / Address</div>
                        <div class="detail-value">{{ complaint[5] if complaint[5] else 'Not provided' }}</div>
                    </div>
                    <div>
                        <div class="detail-label">Crime Type</div>
                        <div class="detail-value">
                            {% if complaint[8] == 'financial' %} Financial / Online Fraud
                            {% elif complaint[8] == 'cyber' %} Cyber / Social Media Crime
                            {% elif complaint[8] == 'women' %} Women / Children Related
                            {% elif complaint[8] == 'theft' %} Theft / Physical Assault
                            {% else %} {{ complaint[8] }} {% endif %}
                        </div>
                    </div>
                </div>

            </div>

            <!-- Detailed description -->
            <div class="detail-card">
                <h4 style="color:#667eea; margin-bottom:10px;">üìÑ Detailed Description</h4>
                <div class="description-box">{{ complaint[9] }}</div>
            </div>

            <!-- Evidence -->
            <div class="detail-card">
                <h4 style="color:#667eea; margin-bottom:10px;">üì∏ Evidence & ID Proof</h4>
                <div class="image-section">
                    <div>
                        <h6>Evidence Image</h6>
                        {% if evidence_img %}
                            <div class="image-container"><img src="data:image/jpeg;base64,{{ evidence_img }}" alt="evidence"></div>
                        {% else %}
                            <div class="image-container"><div style="text-align:center;color:#999;"><i class="fas fa-image" style="font-size:40px;opacity:0.3"></i><p>No evidence image</p></div></div>
                        {% endif %}
                    </div>
                    <div>
                        <h6>ID Proof</h6>
                        {% if idProof_img %}
                            <div class="image-container"><img src="data:image/jpeg;base64,{{ idProof_img }}" alt="idproof"></div>
                        {% else %}
                            <div class="image-container"><div style="text-align:center;color:#999;"><i class="fas fa-id-card" style="font-size:40px;opacity:0.3"></i><p>No ID proof</p></div></div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- AI Assistance -->
            <div class="detail-card">
                <h4 style="color:#667eea; margin-bottom:10px;">ü§ñ AI Assistance</h4>
                <div>
                    {% if ai_report_html is defined and ai_report_html %}
                        {{ ai_report_html | safe }}
                    {% elif ai_report is defined and ai_report %}
                        {{ ai_report.replace('\n','<br>') | safe }}
                    {% else %}
                        <div class="text-muted">No AI analysis available</div>
                    {% endif %}
                </div>
            </div>

            <!-- Staff-only action panel -->
            <div class="action-panel">
                <h5 style="color:#333; margin-bottom:12px;">Staff Actions</h5>
                <form method="POST" action="{{ url_for('update_complaint', complaint_id=complaint[0]) }}">
                    <div class="detail-row">
                        <div>
                            <label class="detail-label">Assign Officer</label>
                            <input type="text" name="assign_officer" class="form-control" placeholder="Officer name or ID" value="{{ complaint[13] if complaint[13] else '' }}">
                        </div>
                        <div>
                            <label class="detail-label">New Status</label>
                            <select name="status" class="form-control">
                                <option value="" disabled>-- Select --</option>
                                <option value="Pending" {% if complaint[22]=='Pending' %}selected{% endif %}>Pending</option>
                                <option value="Progress" {% if complaint[22]=='Progress' %}selected{% endif %}>In Progress</option>
                                <option value="Completed" {% if complaint[22]=='Completed' %}selected{% endif %}>Completed</option>
                                <option value="Rejected" {% if complaint[22]=='Rejected' %}selected{% endif %}>Rejected</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-top:12px;">
                        <label class="detail-label">Remarks / Investigation Notes</label>
                        <textarea name="remarks" class="form-control" rows="4" placeholder="Add remarks, investigation notes, reasons for rejection..." required></textarea>
                    </div>

                    <div style="display:flex; gap:12px; margin-top:16px;">
                        <button type="submit" name="action" value="complete" class="btn-save">
                            <i class="fas fa-check-circle"></i> Mark As Completed
                        </button>
                        <button type="submit" name="action" value="reject" class="btn-assign" onclick="return confirm('Are you sure you want to reject this complaint?')">
                            <i class="fas fa-times-circle"></i> Reject Complaint
                        </button>
                        <a href="{{ url_for('update_status') }}" class="btn btn-secondary" style="margin-left:auto;">Cancel</a>
                    </div>
                </form>
            </div>

        </div>

        <footer>
            <p>¬© 2025 Crime Reporting & Verification System</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
